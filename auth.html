<div>授权中……</div>
<script>
  var url = new URL(window.location)
  var params = url.searchParams
  var code = params.get("code")
  var state = params.get("state")

  function accessToken(code, state) {
    var formData = new FormData()
    formData.append("client_id", "Iv1.26792a5af3379280")
    formData.append("client_secret", "a22c85062021e8e85a13a145d2813978d817cfaf")
    formData.append("code", code)
    formData.append("state", state)

    fetch("https://github.com/login/oauth/access_token", {
      method: "POST",
      mode: 'cors',
      cache: 'no-cache',
      body: formData,
    })
      .then(response => {
        console.log(response);
        if (!response.ok) {
          throw `Get github access token failed: ${response.statusText}`
        }
        return response
      })
      .then(response => response.text())
      .then(text => window.open("index.html"))
      .catch(err => console.error(err))
  }

  accessToken(code, state)
</script>